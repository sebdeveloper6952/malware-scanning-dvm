package services

import (
	"strings"

	"github.com/go-git/go-git/v5"
	"github.com/sebdeveloper6952/malware-dvm/helpers"
)

type goGitService struct{}

func NewGoGitService() GitService {
	return &goGitService{}
}

func (d *goGitService) Clone(repoURL string) (string, error) {
	var (
		path   = "./tmp/" + helpers.RandomBase16String(16)
		output = &strings.Builder{}
	)

	_, err := git.PlainClone(path, false, &git.CloneOptions{
		URL:          repoURL,
		SingleBranch: true,
		Progress:     output,
	})

	return path, err
}
